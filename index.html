<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Game Over</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.24.1/dist/phaser.js"></script>
    
</head>
 

<body style="background-color:black;">


<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 970,
        height: 686,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 300 },
                debug: false
            }
        },
        audio: {
        disableWebAudio: true
        },
        scale: {
            mode: Phaser.Scale.HEIGHT_CONTROLS_WIDTH,
            autoCenter: Phaser.Scale.CENTER_BOTH,
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var game = new Phaser.Game(config);
    var player;
    var platforms;
    var cursors;
    var text;
    var timedEvent;
    

    function preload ()
    {

        

        this.load.audio('song', 'assets/game-over.mp3');
        this.load.image('sky', 'assets/sky.png');
        this.load.image('mountains', 'assets/mountains.png')
        this.load.image('skyline-back', 'assets/skyline-back.png');
		this.load.image('skyline-mid', 'assets/skyline-mid.png');
		this.load.image('skyline-front', 'assets/skyline-front.png'); 
        this.load.image('ground', 'assets/rsz_1ground.png'); 
        this.load.spritesheet('dude', 'assets/spritesheet.png', { frameWidth: 34, frameHeight: 34 });

    }

    function create ()
    {

        var music = this.sound.add('song');
        //music.play();
        this.add.image(0, 0, 'sky').setOrigin(0,0);


        

        this.mountains = this.add.tileSprite(0, 0, game.config.width, game.config.height, 'mountains').setOrigin(0, 0);
        this.skylineBack = this.add.tileSprite(0, 0, game.config.width, game.config.height, 'skyline-back').setOrigin(0, 0);
        //this.skylineMid= this.add.tileSprite(0, 0, game.config.width, game.config.height, 'skyline-mid').setOrigin(0, 0);
        this.skylineFront = this.add.tileSprite(0, 0, game.config.width, game.config.height, 'skyline-front').setOrigin(0, 0);
        this.ground = this.add.tileSprite(0, game.config.height - 101, game.config.width, 101, 'ground').setOrigin(0, 0);


        this.physics.add.existing(this.ground, true);

        player = this.physics.add.sprite((game.config.width / 2) - 80, 450, 'dude').setScale(1.5);
        player.setBounce(0.2);
        player.setCollideWorldBounds(true);

        this.anims.create({
            key: 'right',
            frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 2 }),
            frameRate: 7.5,
            repeat: -1
        });
        player.anims.play('right');

        this.physics.add.collider(player, this.ground);
        cursors = this.input.keyboard.createCursorKeys();

        this.initialTime = 180;

        text = this.add.text(game.config.width / 2, 32, formatTime(this.initialTime));

        timedEvent = this.time.addEvent({ delay: 1000, callback: timerEvent, callbackScope: this, loop: true });

    }

    function update ()
    {
        

        this.mountains.tilePositionX += 0.2;
        this.skylineBack.tilePositionX += 0.4;
        this.skylineFront.tilePositionX += 0.7;  
        this.ground.tilePositionX += 1.4;  

        if (cursors.up.isDown && player.body.touching.down)
        {
            player.setVelocityY(-330);
        }
    }

    function formatTime(seconds)
    {
        var minutes = Math.floor(seconds/60);
        var partInSeconds = seconds%60;
        partInSeconds = partInSeconds.toString().padStart(2,'0');
        return `${minutes}:${partInSeconds}`;
    }


    function timerEvent ()
    {
        if (this.initialTime == 0)
        {
            this.time.removeAllEvents();
        } else {
    
        this.initialTime -= 1; // One second
        text.setText(formatTime(this.initialTime));
        }
    }

</script>

</body>
</html>
